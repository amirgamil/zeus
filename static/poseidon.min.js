const printDOMTree=(e,t="")=>void 0===e.children?t+e[0].tag:(prettyPrint="",e.children.forEach(e=>{prettyPrint+=t+e.tag+"\n"+printDOMTree(e.children,t+"\t")+"\n"}),prettyPrint);function updateDOMProperties(e,t,r){"TEXT_ELEMENT"==t.tag&&"TEXT_ELEMENT"==r.tag&&(e.data=r.nodeValue),Object.keys(t.attributes||[]).forEach((t,r)=>{e.removeAttribute(t)}),Object.keys(t.events||[]).forEach((r,s)=>{e.removeEventListener(r,t.events[r])});var s=r.attributes||[];s.length&&0!==s.length||Object.keys(s).forEach(t=>{((t,r)=>{t&&e[t]===r||(t in e?e[t]=r:e.setAttribute(t,r))})(t,r.attributes[t])}),Object.keys(r.events||[]).forEach((t,s)=>{e.addEventListener(t,r.events[t])})}const isEvent=e=>e.startsWith("on"),isDOM=e=>e.nodeType!==Node.TEXT_NODE,instantiate=e=>{if(e.tag){const t="TEXT_ELEMENT"!==e.tag?document.createElement(e.tag):document.createTextNode(e.nodeValue);return updateDOMProperties(t,normalize(null),e),(e.children||[]).map(instantiate).forEach(e=>{t.appendChild(e)}),t}return e.node?e.node:e},APPEND=1,DELETE=2,REPLACE=3,UPDATE=4,updateQueue=[],performWork=()=>{var e=null;for(let t=0;t<updateQueue.length;t++){const r=updateQueue[t];switch(r.op){case 1:parent=r.details.parent,child=r.details.node,parent&&parent.appendChild(child);break;case 3:dom=r.details.dom,prev=r.details.previous,next=instantiate(r.details.node),dom.replaceWith(next),e=next;break;case 2:parent=r.details.parent,toRemove=r.details.node,parent.removeChild(toRemove);break;case 4:dom=r.details.dom,prev=r.details.prev,newNode=r.details.new,updateDOMProperties(dom,prev,newNode)}}return updateQueue.length=0,e},normalize=e=>e?(e.children||(e.children=[]),e.events||(e.events={}),e.attributes||(e.attributes={}),e):{tag:"",children:[],events:{},attributes:{}},renderVDOM=(e,t,r)=>{if(!e&&!t)return;const s=t&&e&&e.tag===t.tag;t=normalize(t),e=normalize(e);var n=normalize(null);if(s)if(void 0===e.tag)updateQueue.push({op:3,details:{dom:r,previous:t,node:e}}),n=e;else{if(updateQueue.push({op:4,details:{dom:r,prev:t,new:e}}),e.children){const s=Math.max(e.children.length,t.children.length),n=r?r.childNodes:[];for(let i=0;i<s;i++)newChild=e.children[i],prev=t.children[i],domChild=n[i]||!0,child=renderVDOM(newChild,prev,domChild),child&&!prev&&updateQueue.push({op:1,details:{parent:r,node:child}})}n=r}else if(""==e.tag){if(!0!==r)return updateQueue.push({op:2,details:{parent:r.parentNode,node:r}}),n}else if(""==t.tag){if(n=instantiate(e),r)return n;updateQueue.push({op:1,details:{parent:null,node:n}})}else updateQueue.push({op:3,details:{dom:r,previous:t,node:e}});const i=performWork();return i&&""===n.tag&&(n=i),n},node={tag:"",children:[],events:{},attributes:{}};let globalStyleSheet;const CSS_CACHE=new Map;var ruleIndex=0;const parseCSSJSON=(e,t,r,s=!1)=>{const{tag:n,rules:i}=e;var a,o="";s=s;n.includes("@keyframes")||n.includes("@media")?(s=!0,a=n,o+=n+"{\n\n"):a=n.replace("<container>",t);var h="";return h=a+" { \n",i.forEach((e,n)=>{if(e.key){const{key:t,value:r}=e;h+="\t"+t+":"+r+";\n"}else o+=parseCSSJSON(e,t,r,s)}),s&&!o?h+"}":(o?r.push(o+"}"):r.push(h+"}"),"")},initStyleSheet=(e,t,r)=>{const s=CSS_CACHE.get(t),n=document.createElement("style");n.type="text/css",n.setAttribute("data-poseidon","true"),document.head.appendChild(n),globalStyleSheet=n.sheet,parseCSSJSON(e,"."+s,r)},generateUniqueHash=e=>{var t=e;return t+=Math.random().toString(36).substr(2,9)},injectStyles=e=>{for(const t of e)globalStyleSheet.insertRule(t)};class Component{constructor(...e){this.vdom=null,void 0!==this.init&&this.init(...e),this.event={},void 0===this.node&&this.render(this.data)}bind(e,t){if(!(e instanceof Listening))throw"Attempting to bind to an unknown object!";if(void 0===t){const t=e=>this.render(e);e.addHandler(t),this.events={source:e,defaultHandler:t}}else e.addHandler(t),this.events={source:e,handler:t}}addStyle(e){if(this.styles){if(e.attributes.class||(e.attributes.class=""),CSS_CACHE.has(this.constructor.name))e.attributes.class+=" "+CSS_CACHE.get(this.constructor.name);else{const t=generateUniqueHash(this.constructor.name);e.attributes.class+=" "+t,CSS_CACHE.set(this.constructor.name,t)}globalStyleSheet||this.regenerateStyleSheet()}}regenerateStyleSheet(){const e=[],t=this.constructor.name,r=this.styles();initStyleSheet(r,t,e),injectStyles(e)}remove(){const{source:e,handler:t}=this.events;e.remove(),this.events={}}create(e){return null}render(e){const t=this.create(e);return this.addStyle(t),this.node=renderVDOM(t,this.vdom,this.node),this.node||(this.node=document.createComment("")),this.vdom=t,this.node}}class Listening{constructor(){this.handlers=new Set,this.state=null}summarize(){return null}fire(){this.handlers.forEach(e=>{e(this.state)})}remove(){this.handlers.forEach(e=>{this.removeHandler(e)})}addHandler(e){this.handlers.add(e),e(this.state)}removeHandler(e){this.handlers.delete(e)}}class Atom extends Listening{constructor(e){super(),super.state=e}summarize(){return this.state}get comparator(){return null}get type(){return Atom}update(e){for(const t in e)this.state[t]=e[t];this.fire()}get(e){return this.state[e]}serialize(){return JSON.stringify(this.state)}}class List extends Component{constructor(e,t,r){super(e,t,r),this._atomClass=t.atomClass}init(e,t,r){if(!(t instanceof CollectionStore))throw"Error unknown data store provided, please use a CollectionStore!";this.store=t,this.remove=r||(e=>t.remove(e)),this.domElement=e,this.items=new Map,this.nodes=[],this.bind(t,()=>this.itemsChanged())}itemsChanged(){this.store.data.forEach(e=>{if(!this.items.has(e)){const t=new this.domElement(e,this.remove);this.items.set(e,t.node)}});for(let[e,t]of this.items)this.store.has(e)||this.items.delete(e);this.nodes=Array.from(this.items.values()),this.render(this.nodes)}get type(){return this._atomClass}create(e){return html`<ul>
           ${this.nodes}
       </ul>`}}function ListOf(e){return class extends List{constructor(...t){super(e,...t)}}}class CollectionStore extends Listening{constructor(e,t){super(),this._atomClass=t,this.setStore(e)}setStore(e){null!=e&&e.length>0?void 0===this._atomClass?(this.data=new Set(e),this._atomClass=e[0].type):e[0]instanceof Atom?this.data=new Set(e):this.data=new Set(e.map(e=>new this._atomClass(e))):this.data=new Set}summarize(){return JSON.stringify(this.data)}add(e){if(e instanceof Atom)this.data.add(e),void 0===this._atomClass&&(this._atomClass=e.type);else{if(!this.__atomClass)throw"Error, adding a non-atom object without a defined atom class!";this.data.add(new thiss.__atomClass(e))}this.fire()}has(e){return this.data.has(e)}remove(e){this.data.delete(e),e.remove(),this.fire()}serialize(){const e=[...this.data];return e.sort((e,t)=>e.comparator-t.comparator),JSON.stringify(e)}get atomClass(){return this._atomClass}[Symbol.iterator](){return this.data.values()}}function CollectionStoreOf(e){return class extends CollectionStore{constructor(t){super(t,e)}}}const getRegexFromRouteString=e=>{let t=[];return e=e.replace(/[:*](\w+)/g,(e,r,s)=>(t.push(r),"([^/]+)")),e+="(?:/|$)",[new RegExp(e),t]};class Router{constructor(){this.routes=new Map,this.options={context:window,startListening:!0},this.matchHelper=(()=>this.match(window.location.pathname)),window.addEventListener("popstate",this.matchHelper)}match(e){for(let[t,{pathRoute:r,handler:s,params:n}]of this.routes){const i=r.exec(e);if(null!==i){const r=i.slice(1).reduce((e,t,r)=>(e[n[r]]=t,e),{});this.currentPath=t,s(e,r)}}}navigate(e,{replace:t=!1}={}){window.location.pathname!=e&&(t?this.options.context.history.replaceState(null,document.title,e):this.options.context.history.pushState(null,document.title,e),this.match(e))}on(...e){for(const{route:t,handler:r}of e)if(Array.isArray(t))for(const e of t){const[t,s]=getRegexFromRouteString(e);this.routes.set(e,{pathRoute:t,handler:r,params:s})}else{const[e,s]=getRegexFromRouteString(t);this.routes.set(t,{pathRoute:e,handler:r,params:s})}this.match(window.location.pathname)}}class Reader{constructor(e,t){this.string=e,this.index=0,this.length=e.length,this.specialCharacters=new Set(t)}peek(){return this.index<this.length-1?this.string[this.index+1]:null}getNextWord(e=!1){for(var t=this.index,r=t,s=0;this.index<this.length&&(!this.specialCharacters.has(this.currentChar)||!e&&1===s);){if(e||'"'!==this.currentChar&&"'"!==this.currentChar)if("/"===this.currentChar){if(">"===this.peek())break}else r=this.index;else 0===s?(s+=1,t=this.index+1):1===s&&(r=this.index-1,s+=1);this.consume()}if(1==s)throw"Error parsing quotes as values!";return this.skipSpaces(),this.string.substring(t,r+1)}get currentChar(){return this.string[this.index]}skipSpaces(){for(;" "===this.currentChar||"\n"===this.currentChar;)this.consume()}consume(){return this.string[this.index++]}skipToNextChar(){this.consume(),this.skipSpaces()}getUntilChar(e){const t=this.index;for(var r=t;this.currentChar!=e&&this.index<this.length;)this.consume(),r=this.index;return this.string.substring(t,r)}getUntilWord(e){var t=!1;for(">"===this.currentChar&&(t=!0);!t&&this.index<this.length;){this.getUntilChar(e[0]);for(let r=1;r<e.length;r++){if(this.consume(),this.currentChar!==e[r]){t=!1;break}t=!0}}this.skipToNextChar()}skipPastChar(e){var t=this.getUntilChar(e);return t+=this.consume()}}const parseChildren=(e,t,r)=>{try{let n=[];if(foundClosingTag(e,t))return n;for(var s=parseTag(t,r);s!==CLOSED_TAG&&(s&&(Array.isArray(s)?n=s:n.push(s)),!foundClosingTag(e,t));)s=parseTag(t,r);return n}catch(e){throw e}},foundClosingTag=(e,t)=>{if("<"===t.currentChar&&"/"===t.peek()){t.skipPastChar("/");const r=t.getNextWord();if(t.skipPastChar(">"),r!==e)throw"Error parsing the body of an HTML node!";return!0}return!1},parseJSExpr=(e,t,r)=>{var s=t.shift();if(s){if(r)return e.skipSpaces(),"function"==typeof s||"object"==typeof s?s:("string"!=typeof s&&(s=String(s)),s);if("object"==typeof s||"function"==typeof s)return e.skipSpaces(),"function"==typeof s?s():s;"string"!=typeof s&&(s=String(s));const n=new Reader(s,e.specialCharacters);return parseTag(n,t)}return null},parseTag=(e,t)=>{if("<"!==e.currentChar){const t=e.getUntilChar("<");return t?{tag:"TEXT_ELEMENT",nodeValue:t}:null}if("/"===e.peek())return CLOSED_TAG;e.consume();const r=e.getNextWord();if(r===VDOM_PLACEHOLDER)return e.consume(),parseJSExpr(e,t,!1);if(r.startsWith("!--"))return e.getUntilWord("--\x3e"),parseTag(e,t);const s={tag:r,children:[],attributes:{},events:{}};for(var n=!1;">"!==e.currentChar&&e.index<e.length;){const r=e.getNextWord();if("/"===r&&">"===e.peek()){e.consume(),n=!0;break}if("="!==e.currentChar){s.attributes[r]=!0;continue}e.skipToNextChar();let i=e.getNextWord();if("<"===i){if(e.consume(),e.getNextWord()!==VDOM_PLACEHOLDER)throw"Error trying to parse the key-value pairs of a node, unexpected < found!";i=parseJSExpr(e,t,!0),e.skipToNextChar()}else for(;i.includes(VDOM_JSX_NODE);)i=i.replace(VDOM_JSX_NODE,parseJSExpr(e,t,!0));r.startsWith("on")?s.events[r.substring(2)]=i:s.attributes[r]=i}return e.consume(),n||(s.children=parseChildren(r,e,t)),s},VDOM_EXPRESSIONS=new RegExp("${.*?}","g"),VDOM_PLACEHOLDER=`__vdomPlaceholder${Date.now()}`,VDOM_JSX_NODE="<"+VDOM_PLACEHOLDER+">",CLOSED_TAG="</",CSS_PLACEHOLDER=`__container${Date.now()}`,CSS_JSX_NODE="{"+CSS_PLACEHOLDER+"}",html=(e,...t)=>{const r=e.join(VDOM_JSX_NODE,t),s=new Reader(r,[" ","=","<",">"]);try{return s.skipSpaces(),parseTag(s,t)}catch(e){return console.error(e),null}},parseCSStringToDict=(e,t,r,s)=>{for(t.tag=r,t.rules=[];e.index<e.length;){var n=e.getNextWord();if(";"===n)throw console.log(e.string.substring(e.index)),"Error, unexpected end of expression found!";if("{"===n){if(e.consume(),e.getNextWord()===CSS_PLACEHOLDER){const n=s.shift();n&&n.rules.forEach((e,s)=>{e.tag=r+e.tag.replace("<container>",""),t.rules.push(e)}),e.skipToNextChar();continue}throw"Invalid curly brace found in css template literal!"}var i=e.currentChar;if(":"===e.currentChar&&(e.skipToNextChar(),":"===e.currentChar&&(n+="::",e.consume(),n+=e.getNextWord(),e.skipSpaces(),i=e.currentChar),"{"!==i)){var a=e.getNextWord(!0);if("{"===a){if(e.consume(),e.getNextWord()!==CSS_PLACEHOLDER)throw"Invalid JS expression while trying to parse the value of a key!";a=s.shift(),e.skipToNextChar()}if("{"===e.currentChar)n+=":"+a,i=e.currentChar;else if(":"===e.currentChar){e.consume(),n+=":"+a+":"+e.getNextWord().trimStart(),i=e.currentChar}else t.rules.push({key:n,value:a}),e.skipToNextChar()}if("{"===i){e.skipToNextChar();const i={};t.rules.push(i);var o=r+" "+n;(n.includes("@keyframes")||n.includes("@media")||t.tag.includes("@keyframes")||t.tag.includes("@media"))&&(o=n),parseCSStringToDict(e,i,o,s),e.skipToNextChar()}if("}"===e.currentChar)break}return t},css=(e,...t)=>{const r=e.join(CSS_JSX_NODE,t),s=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)","gi"),n=r.replace(s,""),i=new Reader(n,[";","{","}",":"]);try{i.skipSpaces();const e={};return parseCSStringToDict(i,e,"<container>",t),e}catch(e){return console.error(e),null}};